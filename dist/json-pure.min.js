!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.VueJsonPure=t()}(this,function(){"use strict";"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var e=function(e){return e&&e.__esModule?e.default:e}(function(e,t){return t={exports:{}},e(t,t.exports),t.exports}(function(e,t){!function(t,n){e.exports=n()}(0,function(){return function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(e,t,n){function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=function(){function e(){o(this,e),this.listeners=new Map}return r(e,[{key:"addListener",value:function(e,t,n){return"function"==typeof t&&(this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push({callback:t,vm:n}),!0)}},{key:"removeListener",value:function(e,t,n){var o=this.listeners.get(e),r=void 0;return!!(o&&o.length&&(r=o.reduce(function(e,o,r){return"function"==typeof o.callback&&o.callback===t&&o.vm===n&&(e=r),e},-1))>-1)&&(o.splice(r,1),this.listeners.set(e,o),!0)}},{key:"emit",value:function(e){for(var t=arguments,n=arguments.length,o=Array(n>1?n-1:0),r=1;r<n;r++)o[r-1]=t[r];var i=this.listeners.get(e);return!(!i||!i.length||(i.forEach(function(e){var t;(t=e.callback).call.apply(t,[e.vm].concat(o))}),0))}}]),e}();t.default=new i},function(e,t,n){e.exports=n(2)},function(e,t,n){function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=o(n(3)),i=o(n(0));t.default={install:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!t)throw new Error("[vue-native-socket] cannot locate connection");var o=new r.default(t,n);e.prototype.$socket=o.WebSocket,e.mixin({created:function(){var e=this,t=this.$options.sockets;this.$options.sockets=new Proxy({},{set:function(e,t,n){return i.default.addListener(t,n,this),e[t]=n,!0},deleteProperty:function(e,t){return i.default.removeListener(t,this.$options.sockets[t],this),delete e.key,!0}}),t&&Object.keys(t).forEach(function(n){e.$options.sockets[n]=t[n]})},beforeDestroy:function(){var e=this,t=this.$options.sockets;t&&Object.keys(t).forEach(function(t){delete e.$options.sockets[t]})}})}}},function(e,t,n){function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=function(e){return e&&e.__esModule?e:{default:e}}(n(0)),s=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o(this,e),this.format=n.format&&n.format.toLowerCase(),this.connect(t,n),n.store&&(this.store=n.store),this.onEvent()}return r(e,[{key:"connect",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=n.protocol||"";this.WebSocket=n.WebSocket||(""===o?new WebSocket(e):new WebSocket(e,o)),"json"===this.format&&("sendObj"in this.WebSocket||(this.WebSocket.sendObj=function(e){return t.WebSocket.send(JSON.stringify(e))}))}},{key:"onEvent",value:function(){var e=this;["onmessage","onclose","onerror","onopen"].forEach(function(t){e.WebSocket[t]=function(n){i.default.emit(t,n),e.store&&e.passToStore("SOCKET_"+t,n)}})}},{key:"passToStore",value:function(e,t){if(e.startsWith("SOCKET_")){var n="commit",o=e.toUpperCase(),r=t;"json"===this.format&&t.data&&((r=JSON.parse(t.data)).mutation?o=[r.namespace||"",r.mutation].filter(function(e){return!!e}).join("/"):r.action&&(n="dispatch",o=r.action)),this.store[n](o,r)}}}]),e}();t.default=s}])})})),t=function(){this.listeners=new Map};t.prototype.addListener=function(e,t,n){return"function"==typeof t&&(this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push({callback:t,vm:n}),!0)},t.prototype.removeListener=function(e,t,n){var o,r=this.listeners.get(e);return!!(r&&r.length&&(o=r.reduce(function(e,o,r){return"function"==typeof o.callback&&o.callback===t&&o.vm===n&&(e=r),e},-1))>-1)&&(r.splice(o,1),this.listeners.set(e,r),!0)},t.prototype.emit=function(e,t){var n=this.listeners.get(e);if(n&&n.length){for(var o=!0,r=null,i=0;i<n.length&&!0===o;i++)o=!1,(r=n[i]).callback.call(r.vm,t,function(){o=!0});return!0}return!1};var n=new t,o=function(e){this.socket=e};o.prototype.create=function(e,t){this.socket.sendObj({action_str:"create",data_type:e,request_map:t})},o.prototype.retrieve=function(e,t){this.socket.sendObj({action_str:"retrieve",data_type:e,request_map:t})},o.prototype.update=function(e,t){this.socket.sendObj({action_str:"update",data_type:e,request_map:t})},o.prototype.delete=function(e,t){this.socket.sendObj({action_str:"delete",data_type:e,request_map:t})},o.prototype.flush=function(e,t){this.socket.sendObj({action_str:"flush",data_type:e,request_map:t})};var r,i,s,a,c=function(e){console.warn("[json-pure] "+e)},u=function(e,t){var o=t.action_str.split("_");2===o.length&&"FAIL"===o[1]?(n.emit("fail",{action_str:o[0]}),i.store&&f("API_FAIL",Object.assign(t,{action_str:o[0]}))):(n.emit(o[0],t),i.store&&f("API_"+o[0],t))},f=function(e,t){if(e.startsWith("API_")){var n=e.toUpperCase(),o=t;"json"===i.format&&t&&"string"==typeof t&&(o=JSON.parse(t)),i.store.commit(n,o)}};return{install:function(t,f){if(r)c("already installed, Vue.use(VueJsonPure) should only be called once.");else{if(r=t,!f||!f.url)throw new Error("[json-pure] please provide all necessary configuration data");i=f,e.install(t,f.url,f),t.prototype.$api=new o(t.prototype.$socket),s=t.prototype.$api,t.mixin({created:function(){var e=this;if(!a){this.$options.sockets.onmessage=this.websocketOnMessage;var t=this.$options.api;this.$options.api=new Proxy({},{set:function(e,t,o){return n.addListener(t,o,this),e[t]=o,!0},deleteProperty:function(e,t){return n.removeListener(t,this.$options.api[t],this),delete e.key,!0}}),t&&Object.keys(t).forEach(function(n){e.$options.api[n]=t[n]}),a=!0}},beforeDestroy:function(){var e=this,t=this.$options.api;t&&Object.keys(t).forEach(function(t){delete e.$options.api[t]})},methods:{websocketOnMessage:function(e){var t=JSON.parse(e.data);!0!==f.autoPong||"PING"!==t.action_str?u(e,t):this.$socket.sendObj({action_str:"PONG"})}}})}},get api(){return s},version:"1.0.0"}});